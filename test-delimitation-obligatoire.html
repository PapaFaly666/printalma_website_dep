<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - D√©limitation Obligatoire</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .warning-test {
            background: #fff3e0;
            border: 1px solid #ff9800;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success-test {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .validation-section {
            border: 2px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: white;
        }
        .product-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .log-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }
        .error-list {
            background: #ffebee;
            border: 1px solid #f44336;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            color: #c62828;
        }
    </style>
</head>
<body>
    <h1>‚ö†Ô∏è Test - D√©limitation Obligatoire</h1>
    
    <div class="test-section">
        <h2>‚ö†Ô∏è Test de Validation D√©limitation Obligatoire</h2>
        <p>Test de la validation obligatoire des d√©limitations pour les produits mockup admin.</p>
        
        <button onclick="testDelimitationRequired()">Tester D√©limitation Obligatoire</button>
        <button onclick="testProductWithoutDelimitations()">Tester Produit Sans D√©limitations</button>
        <button onclick="testProductWithDelimitations()">Tester Produit Avec D√©limitations</button>
        <button onclick="testValidationStep4()">Tester Validation √âtape 4</button>
        <button onclick="clearResults()">Effacer les R√©sultats</button>
        
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>üìã Simulation de Validation</h2>
        <div id="validation-simulation">
            <!-- La simulation de validation sera affich√©e ici -->
        </div>
    </div>

    <script>
        // Service de validation des d√©limitations obligatoires
        class DelimitationRequiredService {
            constructor() {
                this.logs = [];
            }

            log(message) {
                this.logs.push(`[${new Date().toLocaleTimeString()}] ${message}`);
                console.log(message);
            }

            // Calculer les statistiques du produit
            calculateProductStats(product) {
                const totalImages = product.colorVariations.reduce((total, color) => 
                    total + color.images.length, 0
                );
                const totalDelimitations = product.colorVariations.reduce((total, color) => 
                    total + color.images.reduce((imageTotal, image) => 
                        imageTotal + (image.delimitations?.length || 0), 0
                    ), 0
                );
                
                return {
                    totalImages,
                    totalColors: product.colorVariations.length,
                    totalDelimitations,
                    hasBasicInfo: product.name && product.price > 0 && product.description,
                    hasColors: product.colorVariations.length > 0,
                    hasImages: totalImages > 0,
                    hasDelimitations: totalDelimitations > 0
                };
            }

            // Validation de l'√©tape 4 (Images et d√©limitations)
            validateStep4(product) {
                this.log('üîç Validation de l\'√©tape 4 - D√©limitations obligatoires');
                
                const stats = this.calculateProductStats(product);
                const errors = [];
                
                // V√©rifier qu'il y a au moins une image
                if (stats.totalImages === 0) {
                    errors.push('Au moins une image requise');
                }
                
                // üß† Validation obligatoire des d√©limitations
                if (stats.totalDelimitations === 0) {
                    errors.push('‚ö†Ô∏è D√©limitation obligatoire : Au moins une zone de personnalisation doit √™tre d√©finie pour ce produit mockup admin');
                }
                
                // V√©rifier que chaque image a au moins une d√©limitation
                const imagesWithoutDelimitations = product.colorVariations.flatMap(color => 
                    color.images.filter(image => !image.delimitations || image.delimitations.length === 0)
                );
                
                if (imagesWithoutDelimitations.length > 0) {
                    errors.push(`‚ö†Ô∏è ${imagesWithoutDelimitations.length} image(s) sans d√©limitation. Chaque image doit avoir au moins une zone de personnalisation.`);
                }
                
                return {
                    isValid: errors.length === 0,
                    errors,
                    stats
                };
            }

            // Validation compl√®te du produit
            validateCompleteProduct(product) {
                this.log('üîç Validation compl√®te du produit');
                
                const stats = this.calculateProductStats(product);
                const hasBasicInfo = stats.hasBasicInfo;
                const hasColors = stats.hasColors;
                const hasImages = stats.hasImages;
                const hasDelimitations = stats.hasDelimitations;
                
                const isComplete = hasBasicInfo && hasColors && hasImages && hasDelimitations;
                
                const completionPercentage = Math.round(
                    ((product.name ? 1 : 0) + 
                     (product.price > 0 ? 1 : 0) + 
                     (product.description ? 1 : 0) + 
                     (stats.hasColors ? 1 : 0) + 
                     (stats.hasImages ? 1 : 0) +
                     (stats.hasDelimitations ? 1 : 0)) * 16.67
                );
                
                return {
                    isComplete,
                    completionPercentage,
                    stats,
                    missingElements: {
                        basicInfo: !hasBasicInfo,
                        colors: !hasColors,
                        images: !hasImages,
                        delimitations: !hasDelimitations
                    }
                };
            }

            getLogs() {
                return this.logs.join('\n');
            }

            clearLogs() {
                this.logs = [];
            }
        }

        const validationService = new DelimitationRequiredService();

        // Produits de test
        const mockProductWithoutDelimitations = {
            name: 'T-Shirt Test',
            price: 2500,
            description: 'T-shirt de test sans d√©limitations',
            colorVariations: [
                {
                    id: '1',
                    name: 'Rouge',
                    colorCode: '#ff0000',
                    images: [
                        {
                            id: 'img1',
                            url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmYwMDAwIi8+PC9zdmc+',
                            view: 'Front',
                            delimitations: []
                        }
                    ]
                }
            ]
        };

        const mockProductWithDelimitations = {
            name: 'T-Shirt Test',
            price: 2500,
            description: 'T-shirt de test avec d√©limitations',
            colorVariations: [
                {
                    id: '1',
                    name: 'Rouge',
                    colorCode: '#ff0000',
                    images: [
                        {
                            id: 'img1',
                            url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmYwMDAwIi8+PC9zdmc+',
                            view: 'Front',
                            delimitations: [
                                { id: 'delim1', name: 'Zone Logo', x: 50, y: 30, width: 100, height: 50 }
                            ]
                        }
                    ]
                }
            ]
        };

        // Tests globaux
        window.testDelimitationRequired = () => {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Test de D√©limitation Obligatoire</h3>';

            try {
                validationService.log('üìã Test de validation d√©limitation obligatoire');
                
                const validation = validationService.validateStep4(mockProductWithoutDelimitations);
                
                if (validation.isValid) {
                    resultsDiv.innerHTML += `
                        <div class="test-result success-test">
                            <strong>‚úÖ Validation r√©ussie:</strong><br>
                            <p>Le produit peut √™tre cr√©√©/modifi√©</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML += `
                        <div class="test-result test-error">
                            <strong>‚ùå Validation √©chou√©e:</strong><br>
                            <div class="error-list">
                                ${validation.errors.map(error => `<div>‚Ä¢ ${error}</div>`).join('')}
                            </div>
                        </div>
                    `;
                }
                
                renderValidationSimulation(mockProductWithoutDelimitations);
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result test-error">
                        <strong>‚ùå Erreur:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testProductWithoutDelimitations = () => {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Test Produit Sans D√©limitations</h3>';

            try {
                validationService.log('üìã Test produit sans d√©limitations');
                
                const validation = validationService.validateCompleteProduct(mockProductWithoutDelimitations);
                
                resultsDiv.innerHTML += `
                    <div class="test-result warning-test">
                        <strong>‚ö†Ô∏è Produit sans d√©limitations:</strong><br>
                        <div class="log-section">${validationService.getLogs()}</div>
                        <p>Compl√©tude: ${validation.completionPercentage}%</p>
                        <p>√âl√©ments manquants:</p>
                        <ul>
                            ${validation.missingElements.delimitations ? '<li>‚Ä¢ D√©limitations obligatoires</li>' : ''}
                        </ul>
                    </div>
                `;
                
                renderValidationSimulation(mockProductWithoutDelimitations);
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result test-error">
                        <strong>‚ùå Erreur:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testProductWithDelimitations = () => {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Test Produit Avec D√©limitations</h3>';

            try {
                validationService.log('üìã Test produit avec d√©limitations');
                
                const validation = validationService.validateCompleteProduct(mockProductWithDelimitations);
                
                if (validation.isComplete) {
                    resultsDiv.innerHTML += `
                        <div class="test-result success-test">
                            <strong>‚úÖ Produit valide:</strong><br>
                            <div class="log-section">${validationService.getLogs()}</div>
                            <p>Compl√©tude: ${validation.completionPercentage}%</p>
                            <p>Tous les √©l√©ments requis sont pr√©sents</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML += `
                        <div class="test-result warning-test">
                            <strong>‚ö†Ô∏è Produit incomplet:</strong><br>
                            <p>Compl√©tude: ${validation.completionPercentage}%</p>
                        </div>
                    `;
                }
                
                renderValidationSimulation(mockProductWithDelimitations);
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result test-error">
                        <strong>‚ùå Erreur:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testValidationStep4 = () => {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Test Validation √âtape 4</h3>';

            try {
                const step4Validation = validationService.validateStep4(mockProductWithoutDelimitations);
                
                resultsDiv.innerHTML += `
                    <div class="test-result ${step4Validation.isValid ? 'success-test' : 'test-error'}">
                        <strong>${step4Validation.isValid ? '‚úÖ' : '‚ùå'} Validation √âtape 4:</strong><br>
                        <p>Images: ${step4Validation.stats.totalImages}</p>
                        <p>D√©limitations: ${step4Validation.stats.totalDelimitations}</p>
                        ${step4Validation.errors.length > 0 ? `
                            <div class="error-list">
                                ${step4Validation.errors.map(error => `<div>‚Ä¢ ${error}</div>`).join('')}
                            </div>
                        ` : '<p>Aucune erreur d√©tect√©e</p>'}
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result test-error">
                        <strong>‚ùå Erreur:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.clearResults = () => {
            document.getElementById('test-results').innerHTML = '';
            validationService.clearLogs();
            console.log('üóëÔ∏è R√©sultats effac√©s');
        };

        // Fonction pour afficher la simulation de validation
        function renderValidationSimulation(product) {
            const container = document.getElementById('validation-simulation');
            const validation = validationService.validateCompleteProduct(product);
            
            container.innerHTML = `
                <div class="validation-section">
                    <h3>üìã Validation du Produit</h3>
                    
                    <div class="product-info">
                        <h4>Informations du produit:</h4>
                        <p><strong>Nom:</strong> ${product.name}</p>
                        <p><strong>Prix:</strong> ${product.price} FCFA</p>
                        <p><strong>Description:</strong> ${product.description}</p>
                        <p><strong>Couleurs:</strong> ${product.colorVariations.length}</p>
                        <p><strong>Images:</strong> ${validation.stats.totalImages}</p>
                        <p><strong>D√©limitations:</strong> ${validation.stats.totalDelimitations}</p>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${validation.completionPercentage}%"></div>
                    </div>
                    <p><strong>Compl√©tude:</strong> ${validation.completionPercentage}%</p>
                    
                    ${validation.isComplete ? 
                        '<div class="test-result success-test">‚úÖ Produit valide - Peut √™tre cr√©√©/modifi√©</div>' :
                        '<div class="test-result test-error">‚ùå Produit invalide - √âl√©ments manquants</div>'
                    }
                    
                    ${validation.missingElements.delimitations ? 
                        '<div class="warning-test">‚ö†Ô∏è D√©limitations obligatoires manquantes</div>' : ''
                    }
                </div>
            `;
        }

        // Initialiser l'affichage
        window.addEventListener('load', () => {
            console.log('‚ö†Ô∏è Service de validation d√©limitation obligatoire initialis√©');
            renderValidationSimulation(mockProductWithoutDelimitations);
        });
    </script>
</body>
</html> 