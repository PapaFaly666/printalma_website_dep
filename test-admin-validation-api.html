<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Admin Validation API</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">🧪 Test Admin Validation API</h1>

    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Test des endpoints corrigés</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <button
          id="test-validation-endpoint"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
        >
          🔍 Test GET /api/admin/products/validation
        </button>

        <button
          id="test-old-endpoint"
          class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors"
        >
          ❌ Test GET /admin/products/validation (ancien)
        </button>
      </div>

      <div class="bg-gray-100 rounded p-4">
        <h3 class="font-medium mb-2">Résultats des tests :</h3>
        <div id="test-results" class="font-mono text-sm space-y-2"></div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">📋 Status des corrections</h2>
      <ul class="space-y-2 text-sm">
        <li class="flex items-center gap-2">
          <span class="w-3 h-3 bg-green-500 rounded-full"></span>
          <span>ProductValidationService.ts - ✅ Corrigé</span>
        </li>
        <li class="flex items-center gap-2">
          <span class="w-3 h-3 bg-green-500 rounded-full"></span>
          <span>adminFundsService.ts - ✅ Corrigé</span>
        </li>
        <li class="flex items-center gap-2">
          <span class="w-3 h-3 bg-green-500 rounded-full"></span>
          <span>productPriceService.ts - ✅ Corrigé</span>
        </li>
        <li class="flex items-center gap-2">
          <span class="w-3 h-3 bg-green-500 rounded-full"></span>
          <span>config/api.ts - ✅ Corrigé</span>
        </li>
        <li class="flex items-center gap-2">
          <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
          <span>Server dev - 🚀 Running on http://localhost:5174</span>
        </li>
      </ul>
    </div>
  </div>

  <script>
    const resultsDiv = document.getElementById('test-results');

    function addResult(message, isSuccess = null) {
      const div = document.createElement('div');
      div.className = `p-2 rounded ${
        isSuccess === true ? 'bg-green-100 text-green-800' :
        isSuccess === false ? 'bg-red-100 text-red-800' :
        'bg-blue-100 text-blue-800'
      }`;
      div.textContent = message;
      resultsDiv.appendChild(div);
      div.scrollIntoView({ behavior: 'smooth' });
    }

    async function testEndpoint(url, description) {
      addResult(`🔄 Testing ${description}...`);

      try {
        const startTime = Date.now();
        const response = await fetch(url, {
          credentials: 'include',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          }
        });

        const endTime = Date.now();
        const duration = endTime - startTime;

        if (response.ok) {
          const data = await response.json();
          addResult(`✅ ${description} - Success (${response.status}) in ${duration}ms`, true);
          addResult(`📄 Response: ${JSON.stringify(data).substring(0, 200)}...`);
        } else {
          addResult(`❌ ${description} - Failed (${response.status}) in ${duration}ms`, false);
          const text = await response.text();
          addResult(`📄 Error: ${text.substring(0, 200)}...`);
        }
      } catch (error) {
        addResult(`❌ ${description} - Network Error: ${error.message}`, false);
      }
    }

    document.getElementById('test-validation-endpoint').onclick = () => {
      testEndpoint('/api/admin/products/validation?page=1&limit=5', 'Correct API endpoint');
    };

    document.getElementById('test-old-endpoint').onclick = () => {
      testEndpoint('/admin/products/validation?page=1&limit=5', 'Old incorrect endpoint');
    };

    // Test automatique au chargement
    setTimeout(() => {
      addResult('🚀 Auto-testing corrected endpoint...');
      testEndpoint('/api/admin/products/validation?page=1&limit=5', 'Auto-test correct endpoint');
    }, 1000);
  </script>
</body>
</html>