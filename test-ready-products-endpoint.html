<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Ready Products Endpoint</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .product-card { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .product-name { font-weight: bold; font-size: 16px; }
        .product-status { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .status-draft { background-color: #ffc107; color: #000; }
        .status-published { background-color: #28a745; color: #fff; }
        .product-details { margin-top: 5px; font-size: 14px; color: #666; }
    </style>
</head>
<body>
    <h1>Test Ready Products Endpoint</h1>
    
    <div class="test-section">
        <h2>Test de l'endpoint /products</h2>
        <button onclick="testGetProducts()">GET /products</button>
        <button onclick="testFilterReadyProducts()">Filtrer Produits Pr√™ts</button>
        <button onclick="testGetProductById()">GET /products/26</button>
        <button onclick="testUpdateProduct()">PATCH /products/26</button>
        <button onclick="testDeleteProduct()">DELETE /products/26</button>
    </div>

    <div class="test-section">
        <h2>R√©sultats</h2>
        <div id="logs"></div>
        <div id="products-display"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function displayProducts(products) {
            const displayDiv = document.getElementById('products-display');
            displayDiv.innerHTML = '<h3>Produits Pr√™ts (isReadyProduct: true)</h3>';
            
            const readyProducts = products.filter(p => p.isReadyProduct === true);
            
            if (readyProducts.length === 0) {
                displayDiv.innerHTML += '<p>Aucun produit pr√™t trouv√©</p>';
                return;
            }

            readyProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <span class="product-status status-${product.status.toLowerCase()}">${product.status}</span>
                    <div class="product-details">
                        <strong>ID:</strong> ${product.id} | 
                        <strong>Prix:</strong> ${(product.price / 100).toFixed(2)} ‚Ç¨ | 
                        <strong>Stock:</strong> ${product.stock} | 
                        <strong>Cat√©gories:</strong> ${product.categories.map(c => c.name).join(', ')} | 
                        <strong>Couleurs:</strong> ${product.colorVariations.length} | 
                        <strong>Tailles:</strong> ${product.sizes.length}
                    </div>
                `;
                displayDiv.appendChild(card);
            });
        }

        async function testGetProducts() {
            log('üß™ Test: GET /products', 'info');
            try {
                const response = await fetch('http://localhost:3004/products', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå Erreur HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                const products = await response.json();
                log(`‚úÖ Succ√®s: ${products.length} produits r√©cup√©r√©s`, 'success');
                
                const readyProducts = products.filter(p => p.isReadyProduct === true);
                log(`üìä Produits pr√™ts: ${readyProducts.length}/${products.length}`, 'info');
                
                displayProducts(products);
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
            }
        }

        async function testFilterReadyProducts() {
            log('üß™ Test: Filtrage des produits pr√™ts', 'info');
            try {
                const response = await fetch('http://localhost:3004/products', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå Erreur HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                const products = await response.json();
                const readyProducts = products.filter(p => p.isReadyProduct === true);
                
                log(`‚úÖ Produits pr√™ts trouv√©s: ${readyProducts.length}`, 'success');
                
                readyProducts.forEach(product => {
                    log(`üì¶ ${product.name} (ID: ${product.id}) - ${product.status}`, 'info');
                });
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
            }
        }

        async function testGetProductById() {
            log('üß™ Test: GET /products/26', 'info');
            try {
                const response = await fetch('http://localhost:3004/products/26', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå Erreur HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                const product = await response.json();
                log(`‚úÖ Produit r√©cup√©r√©: ${product.name} (isReadyProduct: ${product.isReadyProduct})`, 'success');
                
                if (product.isReadyProduct) {
                    log(`‚úÖ C'est bien un produit pr√™t`, 'success');
                } else {
                    log(`‚ö†Ô∏è Ce produit n'est pas marqu√© comme pr√™t`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
            }
        }

        async function testUpdateProduct() {
            log('üß™ Test: PATCH /products/26', 'info');
            try {
                const response = await fetch('http://localhost:3004/products/26', {
                    method: 'PATCH',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'published'
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå Erreur HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                const result = await response.json();
                log(`‚úÖ Produit mis √† jour: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
            }
        }

        async function testDeleteProduct() {
            log('üß™ Test: DELETE /products/26', 'info');
            try {
                const response = await fetch('http://localhost:3004/products/26', {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ùå Erreur HTTP ${response.status}: ${errorText}`, 'error');
                    return;
                }

                log(`‚úÖ Produit supprim√© avec succ√®s`, 'success');
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
            }
        }

        log('üöÄ Tests Ready Products Endpoint pr√™ts', 'info');
    </script>
</body>
</html> 