<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test VendorDesignProduct API Implementation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .form-group {
            margin: 10px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .loading {
            color: #007bff;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üß™ Test VendorDesignProduct API Implementation</h1>
    
    <div class="test-section">
        <h2>üìã Configuration</h2>
        <div class="form-group">
            <label for="baseUrl">Base URL:</label>
            <input type="text" id="baseUrl" value="http://localhost:3004" />
        </div>
        <div class="form-group">
            <label for="authToken">Token d'authentification:</label>
            <input type="password" id="authToken" placeholder="Collez votre token JWT ici" />
        </div>
        <button onclick="testConnection()">üîó Tester la connexion</button>
        <div id="connectionResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>1. üì§ Upload Design</h2>
        <div class="form-group">
            <label for="designFile">Fichier design:</label>
            <input type="file" id="designFile" accept="image/*" />
        </div>
        <button onclick="testUploadDesign()">üì§ Tester Upload</button>
        <div id="uploadResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>2. üé® Cr√©er Design-Produit</h2>
        <div class="grid">
            <div>
                <div class="form-group">
                    <label for="productId">ID du produit:</label>
                    <input type="number" id="productId" value="3" />
                </div>
                <div class="form-group">
                    <label for="designName">Nom du design:</label>
                    <input type="text" id="designName" value="Test Design" />
                </div>
                <div class="form-group">
                    <label for="designDescription">Description:</label>
                    <textarea id="designDescription" rows="3">Description du design de test</textarea>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="positionX">Position X (0-1):</label>
                    <input type="range" id="positionX" min="0" max="1" step="0.01" value="0.5" />
                    <span id="positionXValue">0.5</span>
                </div>
                <div class="form-group">
                    <label for="positionY">Position Y (0-1):</label>
                    <input type="range" id="positionY" min="0" max="1" step="0.01" value="0.5" />
                    <span id="positionYValue">0.5</span>
                </div>
                <div class="form-group">
                    <label for="scale">√âchelle (0.1-2):</label>
                    <input type="range" id="scale" min="0.1" max="2" step="0.1" value="1.0" />
                    <span id="scaleValue">1.0</span>
                </div>
                <div class="form-group">
                    <label for="rotation">Rotation (0-360):</label>
                    <input type="range" id="rotation" min="0" max="360" step="1" value="0" />
                    <span id="rotationValue">0</span>
                </div>
            </div>
        </div>
        <button onclick="testCreateDesignProduct()">üé® Cr√©er Design-Produit</button>
        <div id="createResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>3. üìã Lister Design-Produits</h2>
        <div class="form-group">
            <label for="statusFilter">Filtrer par statut:</label>
            <select id="statusFilter">
                <option value="">Tous</option>
                <option value="DRAFT">Brouillon</option>
                <option value="PUBLISHED">Publi√©</option>
                <option value="PENDING_VALIDATION">En attente</option>
                <option value="VALIDATED">Valid√©</option>
                <option value="REJECTED">Rejet√©</option>
            </select>
        </div>
        <button onclick="testListDesignProducts()">üìã Lister</button>
        <div id="listResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>4. ‚úèÔ∏è Mettre √† jour Design-Produit</h2>
        <div class="form-group">
            <label for="updateId">ID du design-produit √† modifier:</label>
            <input type="number" id="updateId" placeholder="ID du design-produit" />
        </div>
        <div class="form-group">
            <label for="newStatus">Nouveau statut:</label>
            <select id="newStatus">
                <option value="DRAFT">Brouillon</option>
                <option value="PUBLISHED">Publi√©</option>
                <option value="PENDING_VALIDATION">En attente</option>
                <option value="VALIDATED">Valid√©</option>
                <option value="REJECTED">Rejet√©</option>
            </select>
        </div>
        <button onclick="testUpdateDesignProduct()">‚úèÔ∏è Mettre √† jour</button>
        <div id="updateResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>5. üóëÔ∏è Supprimer Design-Produit</h2>
        <div class="form-group">
            <label for="deleteId">ID du design-produit √† supprimer:</label>
            <input type="number" id="deleteId" placeholder="ID du design-produit" />
        </div>
        <button onclick="testDeleteDesignProduct()">üóëÔ∏è Supprimer</button>
        <div id="deleteResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>6. üöÄ Workflow Complet</h2>
        <p>Test du workflow complet : Upload + Cr√©ation en une seule op√©ration</p>
        <button onclick="testCompleteWorkflow()">üöÄ Test Complet</button>
        <div id="workflowResult" class="test-result"></div>
    </div>

    <script>
        // Configuration globale
        let uploadedDesignData = null;
        let createdDesignProductId = null;

        // Configuration des ranges
        ['positionX', 'positionY', 'scale', 'rotation'].forEach(id => {
            const input = document.getElementById(id);
            const display = document.getElementById(id + 'Value');
            input.addEventListener('input', () => {
                display.textContent = input.value;
            });
        });

        // Helper pour faire des requ√™tes API
        async function apiRequest(endpoint, options = {}) {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('authToken').value;
            
            if (!token) {
                throw new Error('Token d\'authentification requis');
            }

            const url = `${baseUrl}${endpoint}`;
            
            const defaultOptions = {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                }
            };

            if (options.body && !(options.body instanceof FormData)) {
                defaultOptions.headers['Content-Type'] = 'application/json';
            }

            const response = await fetch(url, { ...defaultOptions, ...options });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }

            return await response.json();
        }

        // Test de connexion
        async function testConnection() {
            const result = document.getElementById('connectionResult');
            result.className = 'test-result loading';
            result.textContent = 'Test de connexion...';

            try {
                // Test avec un endpoint simple comme /health ou /auth/profile
                const response = await apiRequest('/auth/profile');
                result.className = 'test-result success';
                result.textContent = `‚úÖ Connexion r√©ussie!\nUtilisateur: ${response.email || 'N/A'}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur de connexion: ${error.message}`;
            }
        }

        // Test 1: Upload design
        async function testUploadDesign() {
            const result = document.getElementById('uploadResult');
            const fileInput = document.getElementById('designFile');
            
            if (!fileInput.files[0]) {
                result.className = 'test-result error';
                result.textContent = '‚ùå Veuillez s√©lectionner un fichier';
                return;
            }

            result.className = 'test-result loading';
            result.textContent = 'Upload en cours...';

            try {
                const formData = new FormData();
                formData.append('design', fileInput.files[0]);

                const response = await apiRequest('/vendor/design-product/upload-design', {
                    method: 'POST',
                    body: formData
                });

                uploadedDesignData = response;
                result.className = 'test-result success';
                result.textContent = `‚úÖ Upload r√©ussi!\n${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur upload: ${error.message}`;
            }
        }

        // Test 2: Cr√©er design-produit
        async function testCreateDesignProduct() {
            const result = document.getElementById('createResult');
            
            if (!uploadedDesignData) {
                result.className = 'test-result error';
                result.textContent = '‚ùå Veuillez d\'abord uploader un design';
                return;
            }

            result.className = 'test-result loading';
            result.textContent = 'Cr√©ation en cours...';

            try {
                const data = {
                    productId: parseInt(document.getElementById('productId').value),
                    designUrl: uploadedDesignData.designUrl,
                    designPublicId: uploadedDesignData.publicId,
                    designFileName: uploadedDesignData.originalName,
                    positionX: parseFloat(document.getElementById('positionX').value),
                    positionY: parseFloat(document.getElementById('positionY').value),
                    scale: parseFloat(document.getElementById('scale').value),
                    rotation: parseInt(document.getElementById('rotation').value),
                    name: document.getElementById('designName').value,
                    description: document.getElementById('designDescription').value,
                    status: 'DRAFT'
                };

                const response = await apiRequest('/vendor/design-product', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                createdDesignProductId = response.id;
                result.className = 'test-result success';
                result.textContent = `‚úÖ Design-produit cr√©√©!\nID: ${response.id}\n${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur cr√©ation: ${error.message}`;
            }
        }

        // Test 3: Lister design-produits
        async function testListDesignProducts() {
            const result = document.getElementById('listResult');
            result.className = 'test-result loading';
            result.textContent = 'Chargement...';

            try {
                const status = document.getElementById('statusFilter').value;
                const endpoint = status 
                    ? `/vendor/design-product?status=${status}`
                    : '/vendor/design-product';

                const response = await apiRequest(endpoint);
                result.className = 'test-result success';
                result.textContent = `‚úÖ ${response.length} design-produit(s) trouv√©(s)\n${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur listing: ${error.message}`;
            }
        }

        // Test 4: Mettre √† jour design-produit
        async function testUpdateDesignProduct() {
            const result = document.getElementById('updateResult');
            const id = document.getElementById('updateId').value;
            
            if (!id) {
                result.className = 'test-result error';
                result.textContent = '‚ùå Veuillez saisir un ID';
                return;
            }

            result.className = 'test-result loading';
            result.textContent = 'Mise √† jour...';

            try {
                const data = {
                    status: document.getElementById('newStatus').value
                };

                const response = await apiRequest(`/vendor/design-product/${id}/status`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                result.className = 'test-result success';
                result.textContent = `‚úÖ Design-produit mis √† jour!\n${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur mise √† jour: ${error.message}`;
            }
        }

        // Test 5: Supprimer design-produit
        async function testDeleteDesignProduct() {
            const result = document.getElementById('deleteResult');
            const id = document.getElementById('deleteId').value;
            
            if (!id) {
                result.className = 'test-result error';
                result.textContent = '‚ùå Veuillez saisir un ID';
                return;
            }

            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer le design-produit ${id} ?`)) {
                return;
            }

            result.className = 'test-result loading';
            result.textContent = 'Suppression...';

            try {
                const response = await apiRequest(`/vendor/design-product/${id}`, {
                    method: 'DELETE'
                });

                result.className = 'test-result success';
                result.textContent = `‚úÖ Design-produit supprim√©!\n${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur suppression: ${error.message}`;
            }
        }

        // Test 6: Workflow complet
        async function testCompleteWorkflow() {
            const result = document.getElementById('workflowResult');
            const fileInput = document.getElementById('designFile');
            
            if (!fileInput.files[0]) {
                result.className = 'test-result error';
                result.textContent = '‚ùå Veuillez s√©lectionner un fichier';
                return;
            }

            result.className = 'test-result loading';
            result.textContent = 'Workflow complet en cours...';

            try {
                // √âtape 1: Upload
                result.textContent = '√âtape 1/2: Upload du design...';
                const formData = new FormData();
                formData.append('design', fileInput.files[0]);

                const uploadResponse = await apiRequest('/vendor/design-product/upload-design', {
                    method: 'POST',
                    body: formData
                });

                // √âtape 2: Cr√©ation
                result.textContent = '√âtape 2/2: Cr√©ation du design-produit...';
                const createData = {
                    productId: parseInt(document.getElementById('productId').value),
                    designUrl: uploadResponse.designUrl,
                    designPublicId: uploadResponse.publicId,
                    designFileName: uploadResponse.originalName,
                    positionX: parseFloat(document.getElementById('positionX').value),
                    positionY: parseFloat(document.getElementById('positionY').value),
                    scale: parseFloat(document.getElementById('scale').value),
                    rotation: parseInt(document.getElementById('rotation').value),
                    name: document.getElementById('designName').value,
                    description: document.getElementById('designDescription').value,
                    status: 'DRAFT'
                };

                const createResponse = await apiRequest('/vendor/design-product', {
                    method: 'POST',
                    body: JSON.stringify(createData)
                });

                result.className = 'test-result success';
                result.textContent = `‚úÖ Workflow complet r√©ussi!\n\nüîπ Upload:\n${JSON.stringify(uploadResponse, null, 2)}\n\nüîπ Cr√©ation:\n${JSON.stringify(createResponse, null, 2)}`;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `‚ùå Erreur workflow: ${error.message}`;
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Test VendorDesignProduct API Implementation - Pr√™t');
            
            // Info dans la console
            console.log(`
üéØ Instructions:
1. Assurez-vous que le backend est d√©marr√© sur http://localhost:3004
2. Connectez-vous en tant que vendeur pour obtenir un token JWT
3. Collez le token dans le champ "Token d'authentification"
4. Testez la connexion
5. S√©lectionnez un fichier image pour les tests d'upload
6. Utilisez les boutons pour tester chaque fonctionnalit√©

üìã Endpoints test√©s:
- POST /vendor/design-product/upload-design
- POST /vendor/design-product
- GET /vendor/design-product
- PUT /vendor/design-product/:id/status
- DELETE /vendor/design-product/:id
            `);
        });
    </script>
</body>
</html> 