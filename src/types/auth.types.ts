// Types d'authentification basÃ©s sur la documentation API
export enum VendeurType {
  DESIGNER = 'DESIGNER',
  INFLUENCEUR = 'INFLUENCEUR',
  ARTISTE = 'ARTISTE'
}

export type UserRole = 'SUPERADMIN' | 'ADMIN' | 'VENDEUR';

export interface User {
  id: number;
  email: string;
  firstName: string;
  lastName: string;
  role: UserRole;
  vendeur_type: VendeurType | null;
  status: boolean;
  must_change_password?: boolean;
  last_login_at?: string;
  created_at?: string;
  updated_at?: string;
  profile_photo_url?: string | null;
}

export interface LoginRequest {
  email: string;
  password: string;
}

export interface LoginSuccessResponse {
  user: User;
}

export interface LoginPasswordChangeRequiredResponse {
  mustChangePassword: true;
  userId: number;
  message: string;
}

export type LoginResponse = LoginSuccessResponse | LoginPasswordChangeRequiredResponse;

export interface AuthCheckResponse {
  isAuthenticated: boolean;
  user: User;
}

export interface ChangePasswordRequest {
  currentPassword: string;
  newPassword: string;
  confirmPassword: string;
}

// ðŸ†• NOUVEAU - Interface pour changement de mot de passe forcÃ©
export interface ForceChangePasswordRequest {
  userId: number;
  currentPassword: string;
  newPassword: string;
  confirmPassword: string;
}

export interface CreateClientRequest {
  firstName: string;
  lastName: string;
  email: string;
  vendeur_type: VendeurType;
  phone?: string;
  country?: string;
  address?: string;
  shopName?: string;
  profilePhoto?: File | null;
  commissionRate?: number;
}

export interface CreateClientResponse {
  message: string;
  user: User;
}

// ========== NOUVEAUX TYPES POUR GESTION AVANCÃ‰E DES CLIENTS ==========

export interface ClientInfo {
  id: number;
  firstName: string;
  lastName: string;
  email: string;
  vendeur_type: VendeurType;
  role: UserRole;
  status: boolean;
  must_change_password: boolean;
  last_login_at: string | null;
  created_at: string;
  updated_at: string;
  login_attempts: number;
  locked_until: string | null;
}

export interface ListClientsQuery {
  page?: number;
  limit?: number;
  search?: string;
  status?: boolean;
  vendeur_type?: VendeurType;
  sort_by?: 'created_at' | 'last_login_at' | 'firstName' | 'lastName';
  sort_order?: 'ASC' | 'DESC';
}

export interface PaginationInfo {
  page: number;
  limit: number;
  total: number;
  totalPages: number;
  hasNext: boolean;
  hasPrevious: boolean;
}

export interface ListClientsResponse {
  clients: ClientInfo[];
  pagination: PaginationInfo;
}

export interface ToggleClientStatusResponse {
  message: string;
  client: ClientInfo;
}

export type ClientStatusFilter = 'all' | 'active' | 'inactive';

// ========== NOUVEAUX TYPES POUR VENDEURS ==========

export interface VendorInfo {
  id: number;
  firstName: string;
  lastName: string;
  email: string;
  vendeur_type: VendeurType;
  created_at: string;
  last_login_at: string | null;
}

export interface VendorsListResponse {
  vendors: VendorInfo[];
  total: number;
  message: string;
}

export interface VendorStatItem {
  type: VendeurType;
  count: number;
  label: string;
  icon: string;
}

export interface VendorsStatsResponse {
  stats: VendorStatItem[];
  total: number;
  message: string;
}

// ========== CONFIGURATION DES TYPES DE VENDEURS ==========

export interface SellerTypeConfig {
  value: VendeurType;
  label: string;
  icon: string;
  description: string;
}

export const SELLER_TYPE_CONFIG: Record<VendeurType, SellerTypeConfig> = {
  [VendeurType.DESIGNER]: {
    value: VendeurType.DESIGNER,
    label: 'Designer',
    icon: 'ðŸŽ¨',
    description: 'SpÃ©cialiste en crÃ©ation graphique et design visuel'
  },
  [VendeurType.INFLUENCEUR]: {
    value: VendeurType.INFLUENCEUR,
    label: 'Influenceur',
    icon: 'ðŸ“±',
    description: 'Expert en marketing digital et influence sociale'
  },
  [VendeurType.ARTISTE]: {
    value: VendeurType.ARTISTE,
    label: 'Artiste',
    icon: 'ðŸŽ­',
    description: 'CrÃ©ateur d\'Å“uvres artistiques originales'
  }
};

// ========== FONCTIONS UTILITAIRES ==========

export const validateEmail = (email: string): boolean => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};

export const getSellerTypeIcon = (type: VendeurType): string => {
  return SELLER_TYPE_CONFIG[type]?.icon || 'ðŸ‘¤';
};

export const getSellerTypeLabel = (type: VendeurType): string => {
  return SELLER_TYPE_CONFIG[type]?.label || type;
};

export const getClientStatusColor = (status: boolean): string => {
  return status ? 'success' : 'danger';
};

export const formatLastLoginDate = (date: string | null): string => {
  if (!date) return 'Jamais connectÃ©';
  
  const loginDate = new Date(date);
  const now = new Date();
  const diffInHours = Math.floor((now.getTime() - loginDate.getTime()) / (1000 * 60 * 60));
  
  if (diffInHours < 1) return 'Ã€ l\'instant';
  if (diffInHours < 24) return `Il y a ${diffInHours}h`;
  if (diffInHours < 24 * 7) return `Il y a ${Math.floor(diffInHours / 24)} jours`;
  
  return loginDate.toLocaleDateString('fr-FR');
};

export const formatJoinDate = (dateString: string): string => {
  return new Date(dateString).toLocaleDateString('fr-FR');
};

export const isAdmin = (user: User | null): boolean => {
  return user ? ['ADMIN', 'SUPERADMIN'].includes(user.role) : false;
};

export const isSuperAdmin = (user: User | null): boolean => {
  return user ? user.role === 'SUPERADMIN' : false;
};

export const isVendeur = (user: User | null): boolean => {
  return user ? user.role === 'VENDEUR' : false;
};

// Type guards pour les rÃ©ponses de login
export const isLoginSuccess = (response: LoginResponse): response is LoginSuccessResponse => {
  return 'user' in response;
};

export const isPasswordChangeRequired = (response: LoginResponse): response is LoginPasswordChangeRequiredResponse => {
  return 'mustChangePassword' in response;
};

export interface ApiError {
  statusCode: number;
  message: string;
  error?: string;
}

export interface AuthState {
  isAuthenticated: boolean;
  user: User | null;
  mustChangePassword: boolean;
  loading: boolean;
  error: string | null;
}

// MÃ©tadonnÃ©es pour les types de vendeurs (conservÃ© pour compatibilitÃ©)
export interface VendeurTypeMetadata {
  type: VendeurType;
  icon: string;
  label: string;
  description: string;
  color: string;
  bgColor: string;
  features: string[];
}

export const VENDEUR_TYPE_METADATA: Record<VendeurType, VendeurTypeMetadata> = {
  [VendeurType.DESIGNER]: {
    type: VendeurType.DESIGNER,
    icon: 'ðŸŽ¨',
    label: 'Designer',
    description: 'CrÃ©ation de designs graphiques et visuels',
    color: 'text-gray-900',
    bgColor: 'bg-gray-50',
    features: ['Outils de design', 'Templates', 'Galerie', 'Portfolio']
  },
  [VendeurType.INFLUENCEUR]: {
    type: VendeurType.INFLUENCEUR,
    icon: 'ðŸ“±',
    label: 'Influenceur',
    description: 'Promotion via rÃ©seaux sociaux et influence',
    color: 'text-gray-900',
    bgColor: 'bg-gray-100',
    features: ['Analytics', 'Codes promo', 'Marketing', 'RÃ©seaux sociaux']
  },
  [VendeurType.ARTISTE]: {
    type: VendeurType.ARTISTE,
    icon: 'ðŸŽ­',
    label: 'Artiste',
    description: 'CrÃ©ation artistique et Å“uvres originales',
    color: 'text-gray-900',
    bgColor: 'bg-gray-50',
    features: ['Portfolio', 'Galerie d\'Å“uvres', 'Ventes d\'art', 'Expositions']
  }
};

// ðŸ†• NOUVEAUX TYPES POUR PROFIL VENDEUR Ã‰TENDU

export interface ExtendedVendorProfile {
  id: number;
  firstName: string;
  lastName: string;
  email: string;
  vendeur_type: VendeurType;
  phone?: string;
  country?: string;
  address?: string;
  shop_name?: string;
  profile_photo_url?: string;
  created_at: string;
  last_login_at?: string;
}

export interface ExtendedVendorProfileResponse {
  success: boolean;
  vendor: ExtendedVendorProfile;
  message: string;
}

export interface UpdateVendorProfileRequest {
  phone?: string;
  country?: string;
  address?: string;
  shop_name?: string;
  profilePhoto?: File | null;
}

export interface UpdateVendorProfileResponse {
  success: boolean;
  message: string;
  vendor: ExtendedVendorProfile;
}

// Statistiques vendeurs par pays
export interface VendorCountryStats {
  country: string;
  count: number;
  percentage: number;
}

export interface VendorStatsByCountryResponse {
  success: boolean;
  stats: VendorCountryStats[];
  total: number;
  message: string;
}

// Configuration des pays disponibles
export interface CountryOption {
  value: string;
  label: string;
  flag?: string;
}

export const COUNTRIES_LIST: CountryOption[] = [
  { value: 'France', label: 'France', flag: 'ðŸ‡«ðŸ‡·' },
  { value: 'Belgique', label: 'Belgique', flag: 'ðŸ‡§ðŸ‡ª' },
  { value: 'Suisse', label: 'Suisse', flag: 'ðŸ‡¨ðŸ‡­' },
  { value: 'Canada', label: 'Canada', flag: 'ðŸ‡¨ðŸ‡¦' },
  { value: 'Maroc', label: 'Maroc', flag: 'ðŸ‡²ðŸ‡¦' },
  { value: 'Tunisie', label: 'Tunisie', flag: 'ðŸ‡¹ðŸ‡³' },
  { value: 'AlgÃ©rie', label: 'AlgÃ©rie', flag: 'ðŸ‡©ðŸ‡¿' },
  { value: 'SÃ©nÃ©gal', label: 'SÃ©nÃ©gal', flag: 'ðŸ‡¸ðŸ‡³' },
  { value: 'CÃ´te d\'Ivoire', label: 'CÃ´te d\'Ivoire', flag: 'ðŸ‡¨ðŸ‡®' },
  { value: 'Cameroun', label: 'Cameroun', flag: 'ðŸ‡¨ðŸ‡²' },
  { value: 'Mali', label: 'Mali', flag: 'ðŸ‡²ðŸ‡±' },
  { value: 'Burkina Faso', label: 'Burkina Faso', flag: 'ðŸ‡§ðŸ‡«' },
  { value: 'Niger', label: 'Niger', flag: 'ðŸ‡³ðŸ‡ª' },
  { value: 'Madagascar', label: 'Madagascar', flag: 'ðŸ‡²ðŸ‡¬' },
  { value: 'Maurice', label: 'Maurice', flag: 'ðŸ‡²ðŸ‡º' },
  { value: 'RÃ©union', label: 'RÃ©union', flag: 'ðŸ‡·ðŸ‡ª' },
  { value: 'Guadeloupe', label: 'Guadeloupe', flag: 'ðŸ‡¬ðŸ‡µ' },
  { value: 'Martinique', label: 'Martinique', flag: 'ðŸ‡²ðŸ‡¶' },
  { value: 'Guyane', label: 'Guyane', flag: 'ðŸ‡¬ðŸ‡«' },
  { value: 'Ã‰tats-Unis', label: 'Ã‰tats-Unis', flag: 'ðŸ‡ºðŸ‡¸' },
  { value: 'Royaume-Uni', label: 'Royaume-Uni', flag: 'ðŸ‡¬ðŸ‡§' },
  { value: 'Allemagne', label: 'Allemagne', flag: 'ðŸ‡©ðŸ‡ª' },
  { value: 'Espagne', label: 'Espagne', flag: 'ðŸ‡ªðŸ‡¸' },
  { value: 'Italie', label: 'Italie', flag: 'ðŸ‡®ðŸ‡¹' },
  { value: 'Portugal', label: 'Portugal', flag: 'ðŸ‡µðŸ‡¹' },
  { value: 'Pays-Bas', label: 'Pays-Bas', flag: 'ðŸ‡³ðŸ‡±' },
  { value: 'SuÃ¨de', label: 'SuÃ¨de', flag: 'ðŸ‡¸ðŸ‡ª' },
  { value: 'NorvÃ¨ge', label: 'NorvÃ¨ge', flag: 'ðŸ‡³ðŸ‡´' },
  { value: 'Danemark', label: 'Danemark', flag: 'ðŸ‡©ðŸ‡°' },
  { value: 'Finlande', label: 'Finlande', flag: 'ðŸ‡«ðŸ‡®' }
];

// Utilitaires pour validation des uploads
export const validateImageFile = (file: File): { isValid: boolean; error?: string } => {
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
  const maxSize = 5 * 1024 * 1024; // 5MB

  if (!allowedTypes.includes(file.type)) {
    return {
      isValid: false,
      error: 'Type de fichier non autorisÃ©. Utilisez JPG, PNG, GIF ou WebP'
    };
  }

  if (file.size > maxSize) {
    return {
      isValid: false,
      error: 'Fichier trop volumineux. Taille maximale : 5MB'
    };
  }

  return { isValid: true };
};

export const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}; 